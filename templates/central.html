<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Central â€“ PROF-SAFE 24</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
    body {
        background:#0b0b10;
        color:#fff;
        font-family: Arial, Helvetica, sans-serif;
        padding:20px;
    }

    .container {
        max-width:900px;
        margin:0 auto;
    }

    img.logo {
        width:160px;
        border-radius:12px;
        margin-bottom:20px;
    }

    .card {
        background:#15151f;
        padding:20px;
        border-radius:14px;
        box-shadow:0 0 15px rgba(0,0,0,0.5);
        margin-bottom:20px;
    }

    button {
        padding:12px 20px;
        border:none;
        border-radius:10px;
        font-weight:bold;
        cursor:pointer;
        margin-right:10px;
    }
    .btn-on { background:#ff8800; color:#fff; }
    .btn-off { background:#555; color:#fff; }
    .btn-resolve { background:#0066aa; color:#fff; }
    .btn-clear { background:#aa0000; color:#fff; }

    .alert-box {
        background:#20202c;
        padding:12px;
        border-radius:8px;
        margin-bottom:10px;
        border-left:4px solid #ff8800;
    }
</style>

</head>
<body>

<div class="container">

    <img src="/static/logo_prof_safe24.png" class="logo">

    <div class="card">
        <h2>ðŸš¨ CENTRAL DE ALERTAS</h2>

        <audio id="siren" src="/static/siren.mp3"></audio>

        <button class="btn-on" onclick="ligar()">Ligar Sirene</button>
        <button class="btn-off" onclick="desligar()">Desligar</button>
        <button class="btn-resolve" onclick="resolver()">Resolver</button>
        <button class="btn-clear" onclick="limpar()">Limpar Tudo</button>

        <br><br>
        <a href="/report.pdf" target="_blank" class="btn-off" style="padding:12px 18px; display:inline-block;">ðŸ“„ Gerar RelatÃ³rio PDF</a>
    </div>

    <div class="card">
        <h3>ðŸ“‹ Alertas Recebidos</h3>
        <div id="alertas"></div>
    </div>

</div>

<script>
function atualizar() {
    fetch("/api/status")
    .then(r => r.json())
    .then(d => {
        let box = document.getElementById("alertas");
        box.innerHTML = "";

        d.alerts.forEach(a => {
            box.innerHTML += `
                <div class="alert-box">
                    <b>${a.teacher}</b> â€¢ Sala ${a.room}<br>
                    ${a.description}<br>
                    <small>${a.ts} â€” ${a.resolved ? "Resolvido" : "Ativo"}</small>
                </div>
            `;
        });

        let s = document.getElementById("siren");
        if (d.siren) s.play();
        else s.pause();
    });
}
setInterval(atualizar, 1000);

function ligar(){ fetch("/api/siren", {method:"POST", headers:{"Content-Type":"application/json"}, body:'{"action":"on"}'}); }
function desligar(){ fetch("/api/siren", {method:"POST", headers:{"Content-Type":"application/json"}, body:'{"action":"off"}'}); }
function resolver(){ fetch("/api/resolve", {method:"POST"}); }
function limpar(){ fetch("/api/clear", {method:"POST"}); }
</script>

</body>
</html>
