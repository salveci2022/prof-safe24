<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Central â€“ PROF-SAFE 24</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
    body { background:#0b0b10; color:#fff; font-family: Arial; padding:20px; }
    .container { max-width:800px; margin:0 auto; }
    .card {
        background:#15151f; padding:20px; border-radius:14px;
        box-shadow:0 0 15px rgba(0,0,0,0.5);
        margin-bottom:20px;
    }
    .alert-box {
        background:#20202c; padding:12px; border-radius:8px;
        margin-bottom:10px; border-left:4px solid #ff8800;
    }
    button {
        padding:10px 18px; border-radius:8px; cursor:pointer;
        font-weight:bold; border:none; margin-right:10px;
    }
    .btn-on { background:#ff8800; color:#fff; }
    .btn-off { background:#444; color:#fff; }
    .btn-clear { background:#aa0000; color:#fff; }
    .btn-resolve { background:#0066aa; color:#fff; }
</style>

</head>
<body>

<div class="container">

    <div class="card">
        <h2>ðŸš¨ Central de Alertas</h2>
        <audio id="siren" src="/static/sounds/siren.mp3"></audio>

        <button class="btn-on" onclick="ligarSirene()">Ligar Sirene</button>
        <button class="btn-off" onclick="desligarSirene()">Desligar</button>
        <button class="btn-resolve" onclick="resolver()">Resolver PrÃ³ximo</button>
        <button class="btn-clear" onclick="limpar()">Limpar Tudo</button>

        <a href="/report.pdf" target="_blank" class="btn-off" style="display:inline-block;margin-top:10px;">
            ðŸ“„ Gerar RelatÃ³rio PDF
        </a>
    </div>

    <div class="card">
        <h3>ðŸ“‹ Alertas Recebidos</h3>
        <div id="alertas"></div>
    </div>

</div>

<script>
function atualizar() {
    fetch("/api/status")
    .then(r => r.json())
    .then(d => {
        let box = document.getElementById("alertas");
        box.innerHTML = "";

        d.alerts.forEach(a => {
            box.innerHTML += `
                <div class="alert-box">
                    <b>${a.teacher}</b> â€“ Sala: <b>${a.room}</b><br>
                    ${a.description}<br>
                    <small>${a.ts} â€“ ${a.resolved ? "Resolvido" : "Ativo"}</small>
                </div>
            `;
        });

        let s = document.getElementById("siren");
        if (d.siren && !d.muted) s.play();
        else s.pause();
    });
}
setInterval(atualizar, 1000);

function ligarSirene(){ fetch("/api/siren",{method:"POST",headers:{"Content-Type":"application/json"},body:'{"action":"on"}'}); }
function desligarSirene(){ fetch("/api/siren",{method:"POST",headers:{"Content-Type":"application/json"},body:'{"action":"off"}'}); }
function resolver(){ fetch("/api/resolve",{method:"POST"}); }
function limpar(){ fetch("/api/clear",{method:"POST"}); }

</script>

</body>
</html>
