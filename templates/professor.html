
<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>PROF-SAFE 24 ‚Äì Professor</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: "Segoe UI", system-ui, sans-serif;
    }
    body {
      min-height: 100vh;
      background: radial-gradient(circle at top, #071426 0, #020712 45%, #000 100%);
      color: #e6f4ff;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 22px;
    }
    .card {
      width: 100%;
      max-width: 520px;
      background: linear-gradient(145deg, rgba(5, 14, 32, 0.98), rgba(3, 10, 24, 0.98));
      border-radius: 26px;
      border: 1px solid rgba(0, 255, 200, 0.25);
      box-shadow: 0 0 30px rgba(0, 255, 200, 0.18);
      padding: 22px 22px 18px;
      display: flex;
      flex-direction: column;
      gap: 14px;
    }
    .top-row {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .top-row img {
      width: 120px;
      height: 120px;
      border-radius: 18px;
      object-fit: cover;
      box-shadow: 0 0 16px rgba(0, 255, 200, 0.35);
    }
    .title-block h1 {
      font-size: 18px;
      letter-spacing: 0.12em;
      text-transform: uppercase;
    }
    .title-block h1 span {
      color: #3fffd7;
    }
    .title-block p {
      margin-top: 4px;
      font-size: 12px;
      color: #9fb6ff;
    }
    .badge {
      margin-top: 4px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 3px 9px;
      border-radius: 999px;
      background: rgba(255, 123, 50, 0.14);
      border: 1px solid rgba(255, 155, 92, 0.7);
      font-size: 11px;
      color: #ffd2a3;
    }
    .badge-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: radial-gradient(circle, #ffb347, #ff7b32);
      box-shadow: 0 0 10px rgba(255, 140, 82, 0.7);
    }
    .field {
      margin-top: 8px;
    }
    label {
      display: block;
      font-size: 12px;
      color: #c8d6ff;
      margin-bottom: 3px;
    }
    input, select, textarea {
      width: 100%;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid rgba(120, 162, 255, 0.6);
      background: rgba(3, 13, 32, 0.9);
      color: #e6f4ff;
      font-size: 13px;
      outline: none;
    }
    textarea {
      border-radius: 14px;
      resize: vertical;
      min-height: 60px;
    }
    input:focus, select:focus, textarea:focus {
      border-color: #3fffd7;
      box-shadow: 0 0 0 1px rgba(63, 255, 215, 0.5);
    }
    .urgencia-row {
      display: flex;
      gap: 6px;
      margin-top: 6px;
    }
    .urgencia-btn {
      flex: 1;
      text-align: center;
      padding: 6px 8px;
      border-radius: 999px;
      border: 1px solid rgba(120, 162, 255, 0.6);
      font-size: 12px;
      cursor: pointer;
      background: rgba(3, 13, 32, 0.9);
      color: #d3e4ff;
      transition: all 0.16s ease-out;
    }
    .urgencia-btn.active-baixa {
      background: rgba(63, 255, 215, 0.12);
      border-color: #3fffd7;
      color: #b9ffe0;
    }
    .urgencia-btn.active-media {
      background: rgba(255, 179, 71, 0.12);
      border-color: #ffb347;
      color: #ffe0b3;
    }
    .urgencia-btn.active-alta {
      background: rgba(255, 77, 109, 0.12);
      border-color: #ff4d6d;
      color: #ffc2d0;
    }
    .main-btn {
      margin-top: 10px;
      width: 100%;
      padding: 11px 16px;
      border-radius: 999px;
      border: none;
      outline: none;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      background: linear-gradient(135deg, #ff7b32, #ffb347);
      color: #1b0900;
      box-shadow: 0 0 20px rgba(255, 140, 82, 0.5);
      transition: all 0.16s ease-out;
    }
    .main-btn:hover {
      filter: brightness(1.06);
      transform: translateY(-1px);
    }
    .bottom-row {
      margin-top: 6px;
      display: flex;
      justify-content: space-between;
      gap: 8px;
      flex-wrap: wrap;
    }
    .link-btn {
      border: none;
      background: none;
      color: #9fb6ff;
      font-size: 12px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 6px;
      border-radius: 999px;
      transition: background 0.15s ease;
    }
    .link-btn:hover {
      background: rgba(7, 28, 64, 0.9);
    }
    .small-note {
      margin-top: 4px;
      font-size: 11px;
      color: #7f8cbb;
    }
    .small-note strong {
      color: #ffb347;
    }
  </style>
</head>
<body>
  <div class="card">
    <div class="top-row">
      <img src="{{ url_for('static', filename='logo_prof_safe24.png') }}" alt="PROF-SAFE 24">
      <div class="title-block">
        <h1>PROF-SAFE <span>24</span> ‚Äì Professor</h1>
        <p>Envie um alerta r√°pido para a Central em caso de emerg√™ncia ou risco.</p>
        <div class="badge">
          <span class="badge-dot"></span>
          <span>Conectado √† Central</span>
        </div>
      </div>
    </div>

    <div class="field">
      <label>Escola (configurada na Central)</label>
      <input type="text" id="escola_label" readonly placeholder="Escola n√£o configurada na Central">
    </div>

    <div class="field">
      <label>Seu nome (opcional)</label>
      <input type="text" id="professor" placeholder="Ex: Prof. Ana, Prof. Jo√£o">
    </div>

    <div class="field">
      <label>Sala / Local</label>
      <input type="text" id="sala" placeholder="Ex: 5¬∫ A, P√°tio, Corredor 2">
    </div>

    <div class="field">
      <label>Tipo de ocorr√™ncia</label>
      <select id="tipo">
        <option value="Conflito/Briga">Conflito/Briga</option>
        <option value="Problema de sa√∫de">Problema de sa√∫de</option>
        <option value="Pessoa suspeita">Pessoa suspeita</option>
        <option value="Outra situa√ß√£o">Outra situa√ß√£o</option>
      </select>
    </div>

    <div class="field">
      <label>N√≠vel de urg√™ncia</label>
      <div class="urgencia-row">
        <div class="urgencia-btn active-media" data-level="M√©dia" id="urg-baixa">Baixa</div>
        <div class="urgencia-btn active-media" data-level="M√©dia" id="urg-media">M√©dia</div>
        <div class="urgencia-btn" data-level="Alta" id="urg-alta">Alta</div>
      </div>
    </div>

    <div class="field">
      <label>Descreva rapidamente o que est√° acontecendo</label>
      <textarea id="descricao" placeholder="Ex: briga entre alunos, aluno passando mal, pessoa suspeita no port√£o..."></textarea>
    </div>

    <button class="main-btn" onclick="enviarAlerta()">
      üö® ENVIAR ALERTA PARA A CENTRAL
    </button>

    <div class="bottom-row">
      <button class="link-btn" onclick="reiniciarCampos()">‚ü≥ Reiniciar</button>
      <button class="link-btn" onclick="limparCampos()">üßπ Limpar</button>
      <button class="link-btn" onclick="sair()">‚èª Sair</button>
    </div>

    <p class="small-note">
      Dica: mantenha este atalho salvo na tela inicial do seu celular para acesso mais r√°pido. A escola configura os dados da
      Central; o professor apenas escolhe sala/local e envia o alerta.
    </p>
  </div>

  <script>
    let urgenciaAtual = 'M√©dia';

    function setUrgencia(level) {
      urgenciaAtual = level;
      document.getElementById('urg-baixa').className = 'urgencia-btn';
      document.getElementById('urg-media').className = 'urgencia-btn';
      document.getElementById('urg-alta').className = 'urgencia-btn';
      if (level === 'Baixa') {
        document.getElementById('urg-baixa').className = 'urgencia-btn active-baixa';
      } else if (level === 'M√©dia') {
        document.getElementById('urg-media').className = 'urgencia-btn active-media';
      } else {
        document.getElementById('urg-alta').className = 'urgencia-btn active-alta';
      }
    }

    document.getElementById('urg-baixa').onclick = () => setUrgencia('Baixa');
    document.getElementById('urg-media').onclick = () => setUrgencia('M√©dia');
    document.getElementById('urg-alta').onclick = () => setUrgencia('Alta');

    function carregarEscolaProfessor() {
      fetch('/api/escola')
        .then(r => r.json())
        .then(data => {
          const label = document.getElementById('escola_label');
          if (data && data.nome) {
            label.value = data.nome + (data.cnpj ? ' ‚Ä¢ CNPJ: ' + data.cnpj : '');
          } else {
            label.placeholder = 'Escola n√£o configurada na Central';
          }
        });
    }

    function enviarAlerta() {
      const payload = {
        professor: document.getElementById('professor').value || 'N√£o informado',
        sala: document.getElementById('sala').value || 'N√£o informado',
        descricao: document.getElementById('descricao').value || '',
        tipo: document.getElementById('tipo').value,
        urgencia: urgenciaAtual
      };
      fetch('/api/alerta', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      })
      .then(r => r.json())
      .then(data => {
        if (window.opener && window.opener._tocarSireneProfSafe24) {
          window.opener._tocarSireneProfSafe24();
        }
        if (window._tocarSireneProfSafe24) {
          window._tocarSireneProfSafe24();
        }
        alert('‚úÖ Alerta enviado para a Central.');
      })
      .catch(() => alert('N√£o foi poss√≠vel enviar o alerta. Verifique a conex√£o com a Central.'));
    }

    function reiniciarCampos() {
      document.getElementById('professor').value = '';
      document.getElementById('sala').value = '';
      document.getElementById('descricao').value = '';
      document.getElementById('tipo').value = 'Conflito/Briga';
      setUrgencia('M√©dia');
    }

    function limparCampos() {
      document.getElementById('descricao').value = '';
    }

    function sair() {
      window.location.href = "/";
    }

    carregarEscolaProfessor();
  </script>
</body>
</html>
